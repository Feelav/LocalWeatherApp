using System;
using System.Collections.Generic;
using FluentAssertions;
using LocalWeatherApp.Services.WeatherService;
using LocalWeatherApp.Services.WeatherService.Models;
using Newtonsoft.Json;
using Xunit;

namespace LocalWeatherApp.Test.UnitTests.Services
{
    public class WeatherServiceTest
    {
        #region Data
        public static IEnumerable<object[]> TestCorrectLocation => new []
            {
                new object[] {"{\"distance\":1836,\"title\":\"Santa Cruz\",\"location_type\":\"City\",\"woeid\":2488853,\"latt_long\":\"36.974018,-122.030952\"}"},
                new object[] {"{\"distance\":43722,\"title\":\"San Jose\",\"location_type\":\"City\",\"woeid\":2488042,\"latt_long\":\"37.338581,-121.885567\"}"},
                new object[] {"{\"distance\":49177,\"title\":\"Mountain View\",\"location_type\":\"City\",\"woeid\":2455920,\"latt_long\":\"37.39999,-122.079552\"}"}
            };

        public static IEnumerable<object[]> TestIncorrectLocation => new []
            {
                //missing woeid
                new object[] {"{\"distance\":1836,\"title\":\"Santa Cruz\",\"location_type\":\"City\",\"latt_long\":\"36.974018,-122.030952\"}"},
                //TODO: Implement if shown in the UI
                ////missing location_type
                //new object[] {"{\"distance\":43722,\"title\":\"San Jose\",\"woeid\":2488042,\"latt_long\":\"37.338581,-121.885567\"}"},
                //missing title
                new object[] {"{\"distance\":49177,\"location_type\":\"City\",\"woeid\":2455920,\"latt_long\":\"37.39999,-122.079552\"}"}
            };

        public static IEnumerable<object[]> TestCorrectLocationDetail => new[]
            {
                new object[] {"{\"consolidated_weather\":[{\"id\":6100206489698304,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:01.810495Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":16.65,\"max_temp\":27.295,\"the_temp\":26.729999999999997,\"wind_speed\":3.4326939669450414,\"wind_direction\":327.7226896412808,\"air_pressure\":1019,\"humidity\":66,\"visibility\":15.121067963095522,\"predictability\":70},{\"id\":4807910557220864,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:04.313798Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":15.465,\"max_temp\":24.335,\"the_temp\":22.655,\"wind_speed\":11.411824173692304,\"wind_direction\":326.64372286287215,\"air_pressure\":1015,\"humidity\":59,\"visibility\":16.28676031973276,\"predictability\":71},{\"id\":5933810464063488,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:07.296917Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":12.835,\"max_temp\":23.14,\"the_temp\":22.535,\"wind_speed\":9.075349601018056,\"wind_direction\":340.50034287084117,\"air_pressure\":1015,\"humidity\":46,\"visibility\":18.439811500835123,\"predictability\":71},{\"id\":5801361566334976,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:11.208215Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":13.26,\"max_temp\":23.3,\"the_temp\":20.795,\"wind_speed\":6.032426576712002,\"wind_direction\":345.36344129551236,\"air_pressure\":1014.5,\"humidity\":45,\"visibility\":18.7290597908216,\"predictability\":70},{\"id\":5471234299002880,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:08:13.323897Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":13.85,\"max_temp\":23.54,\"the_temp\":21.61,\"wind_speed\":4.622621959614517,\"wind_direction\":9.219028807260994,\"air_pressure\":1014.5,\"humidity\":53,\"visibility\":17.685466873459,\"predictability\":70},{\"id\":5370860510642176,\"weather_state_name\":\"Showers\",\"weather_state_abbr\":\"s\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:16.227144Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":14.69,\"max_temp\":25.575,\"the_temp\":29.77,\"wind_speed\":5.15748289986479,\"wind_direction\":346.5,\"air_pressure\":1008,\"humidity\":67,\"visibility\":9.999726596675416,\"predictability\":73}],\"time\":\"2020-02-01T08:50:45.356065-08:00\",\"sun_rise\":\"2020-02-01T07:10:50.681682-08:00\",\"sun_set\":\"2020-02-01T17:31:49.852718-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360},{\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"Santa Cruz\",\"location_type\":\"City\",\"woeid\":2488853,\"latt_long\":\"36.974018,-122.030952\",\"timezone\":\"America/Los_Angeles\"}"},
                new object[] {"{\"consolidated_weather\":[{\"id\":6364089280364544,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:40.134222Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":7.04,\"max_temp\":19.634999999999998,\"the_temp\":17.63,\"wind_speed\":2.1164638511095206,\"wind_direction\":326,\"air_pressure\":1024,\"humidity\":65,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5525947728003072,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:43.422590Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":5.5,\"max_temp\":12.695,\"the_temp\":12.15,\"wind_speed\":8.71490415970731,\"wind_direction\":304.5,\"air_pressure\":1018,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":71},{\"id\":4822089024405504,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:46.140485Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":3.28,\"max_temp\":12.035,\"the_temp\":10.95,\"wind_speed\":6.718962260399269,\"wind_direction\":342,\"air_pressure\":1019,\"humidity\":41,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5944320920125440,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:49.300282Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":3.18,\"max_temp\":12.685,\"the_temp\":10.96,\"wind_speed\":4.103125347967868,\"wind_direction\":9.499999999999998,\"air_pressure\":1023,\"humidity\":32,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":6274590349197312,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:52.213438Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":3.185,\"max_temp\":15.915,\"the_temp\":14.07,\"wind_speed\":1.5716090034200272,\"wind_direction\":351.5,\"air_pressure\":1025,\"humidity\":37,\"visibility\":9.999726596675416,\"predictability\":70},{\"id\":5868348292202496,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:55.911835Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":5.12,\"max_temp\":18.009999999999998,\"the_temp\":16.5,\"wind_speed\":1.6823872584108805,\"wind_direction\":340,\"air_pressure\":1022,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":68}],\"time\":\"2020-02-01T08:53:38.902747-08:00\",\"sun_rise\":\"2020-02-01T07:11:51.633046-08:00\",\"sun_set\":\"2020-02-01T17:31:11.633241-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"Mountain View\",\"location_type\":\"City\",\"woeid\":2455920,\"latt_long\":\"37.39999,-122.079552\",\"timezone\":\"America/Los_Angeles\"}"},
                new object[]{"{\"consolidated_weather\":[{\"id\":5421296982687744,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T15:28:52.246425Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":7.605,\"max_temp\":18.915,\"the_temp\":17.979999999999997,\"wind_speed\":2.3199637007396805,\"wind_direction\":309.2090295859457,\"air_pressure\":1024.5,\"humidity\":67,\"visibility\":14.527658474508868,\"predictability\":68},{\"id\":6589470885281792,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T15:28:55.323094Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":5.78,\"max_temp\":12.3,\"the_temp\":12.265,\"wind_speed\":11.20130820647154,\"wind_direction\":308.0028554874213,\"air_pressure\":1018.5,\"humidity\":51,\"visibility\":16.17739898989899,\"predictability\":70},{\"id\":6547196889530368,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T15:28:58.601143Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":3.455,\"max_temp\":11.280000000000001,\"the_temp\":11.379999999999999,\"wind_speed\":8.017165173599512,\"wind_direction\":339.83337612796305,\"air_pressure\":1019,\"humidity\":38,\"visibility\":18.415888709933984,\"predictability\":68},{\"id\":6484074803757056,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T15:29:01.222194Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":2.08,\"max_temp\":11.940000000000001,\"the_temp\":11.36,\"wind_speed\":5.104286098645245,\"wind_direction\":356.5643895906268,\"air_pressure\":1022,\"humidity\":32,\"visibility\":18.765410005567485,\"predictability\":68},{\"id\":5212155295039488,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T15:29:04.397657Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":3.315,\"max_temp\":15.26,\"the_temp\":13.705,\"wind_speed\":2.076727135613351,\"wind_direction\":326.65138448665454,\"air_pressure\":1024,\"humidity\":37,\"visibility\":17.710943092340727,\"predictability\":70},{\"id\":5768939797741568,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T15:29:07.498660Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":5.654999999999999,\"max_temp\":17.585,\"the_temp\":16.5,\"wind_speed\":1.5973872584108804,\"wind_direction\":341.5,\"air_pressure\":1022,\"humidity\":49,\"visibility\":9.999726596675416,\"predictability\":68}],\"time\":\"2020-02-01T08:54:32.620654-08:00\",\"sun_rise\":\"2020-02-01T07:10:57.961227-08:00\",\"sun_set\":\"2020-02-01T17:30:32.270270-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"BBC\",\"slug\":\"bbc\",\"url\":\"http://www.bbc.co.uk/weather/\",\"crawl_rate\":360},{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"San Jose\",\"location_type\":\"City\",\"woeid\":2488042,\"latt_long\":\"37.338581,-121.885567\",\"timezone\":\"America/Los_Angeles\"}"}, 
            };

        public static IEnumerable<object[]> TestIncorrectLocationDetail => new[]
            {
            ////missing weather_state_name
            //    new object[] {"{\"consolidated_weather\":[{\"id\":6100206489698304,\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:01.810495Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":16.65,\"max_temp\":27.295,\"the_temp\":26.729999999999997,\"wind_speed\":3.4326939669450414,\"wind_direction\":327.7226896412808,\"air_pressure\":1019,\"humidity\":66,\"visibility\":15.121067963095522,\"predictability\":70},{\"id\":4807910557220864,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:04.313798Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":15.465,\"max_temp\":24.335,\"the_temp\":22.655,\"wind_speed\":11.411824173692304,\"wind_direction\":326.64372286287215,\"air_pressure\":1015,\"humidity\":59,\"visibility\":16.28676031973276,\"predictability\":71},{\"id\":5933810464063488,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:07.296917Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":12.835,\"max_temp\":23.14,\"the_temp\":22.535,\"wind_speed\":9.075349601018056,\"wind_direction\":340.50034287084117,\"air_pressure\":1015,\"humidity\":46,\"visibility\":18.439811500835123,\"predictability\":71},{\"id\":5801361566334976,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:11.208215Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":13.26,\"max_temp\":23.3,\"the_temp\":20.795,\"wind_speed\":6.032426576712002,\"wind_direction\":345.36344129551236,\"air_pressure\":1014.5,\"humidity\":45,\"visibility\":18.7290597908216,\"predictability\":70},{\"id\":5471234299002880,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:08:13.323897Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":13.85,\"max_temp\":23.54,\"the_temp\":21.61,\"wind_speed\":4.622621959614517,\"wind_direction\":9.219028807260994,\"air_pressure\":1014.5,\"humidity\":53,\"visibility\":17.685466873459,\"predictability\":70},{\"id\":5370860510642176,\"weather_state_name\":\"Showers\",\"weather_state_abbr\":\"s\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:08:16.227144Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":14.69,\"max_temp\":25.575,\"the_temp\":29.77,\"wind_speed\":5.15748289986479,\"wind_direction\":346.5,\"air_pressure\":1008,\"humidity\":67,\"visibility\":9.999726596675416,\"predictability\":73}],\"time\":\"2020-02-01T08:50:45.356065-08:00\",\"sun_rise\":\"2020-02-01T07:10:50.681682-08:00\",\"sun_set\":\"2020-02-01T17:31:49.852718-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360},{\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.wldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"Santa Cruz\",\"location_type\":\"City\",\"woeid\":2488853,\"latt_long\":\"36.974018,-122.030952\",\"timezone\":\"America/Los_Angeles\"}"},
                ////missing weather_state_abbr
                //new object[] {"{\"consolidated_weather\":[{\"id\":6364089280364544,\"weather_state_name\":\"Clear\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:40.134222Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":7.04,\"max_temp\":19.634999999999998,\"the_temp\":17.63,\"wind_speed\":2.1164638511095206,\"wind_direction\":326,\"air_pressure\":1024,\"humidity\":65,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5525947728003072,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:43.422590Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":5.5,\"max_temp\":12.695,\"the_temp\":12.15,\"wind_speed\":8.71490415970731,\"wind_direction\":304.5,\"air_pressure\":1018,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":71},{\"id\":4822089024405504,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:46.140485Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":3.28,\"max_temp\":12.035,\"the_temp\":10.95,\"wind_speed\":6.718962260399269,\"wind_direction\":342,\"air_pressure\":1019,\"humidity\":41,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5944320920125440,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:49.300282Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":3.18,\"max_temp\":12.685,\"the_temp\":10.96,\"wind_speed\":4.103125347967868,\"wind_direction\":9.499999999999998,\"air_pressure\":1023,\"humidity\":32,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":6274590349197312,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:52.213438Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":3.185,\"max_temp\":15.915,\"the_temp\":14.07,\"wind_speed\":1.5716090034200272,\"wind_direction\":351.5,\"air_pressure\":1025,\"humidity\":37,\"visibility\":9.999726596675416,\"predictability\":70},{\"id\":5868348292202496,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:55.911835Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":5.12,\"max_temp\":18.009999999999998,\"the_temp\":16.5,\"wind_speed\":1.6823872584108805,\"wind_direction\":340,\"air_pressure\":1022,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":68}],\"time\":\"2020-02-01T08:53:38.902747-08:00\",\"sun_rise\":\"2020-02-01T07:11:51.633046-08:00\",\"sun_set\":\"2020-02-01T17:31:11.633241-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"Mountain View\",\"location_type\":\"City\",\"woeid\":2455920,\"latt_long\":\"37.39999,-122.079552\",\"timezone\":\"America/Los_Angeles\"}"},
                //missing min_temp
                new object[] {"{\"consolidated_weather\":[{\"id\":6364089280364544,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:40.134222Z\",\"applicable_date\":\"2020-02-01\",\"max_temp\":19.634999999999998,\"the_temp\":17.63,\"wind_speed\":2.1164638511095206,\"wind_direction\":326,\"air_pressure\":1024,\"humidity\":65,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5525947728003072,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:43.422590Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":5.5,\"max_temp\":12.695,\"the_temp\":12.15,\"wind_speed\":8.71490415970731,\"wind_direction\":304.5,\"air_pressure\":1018,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":71},{\"id\":4822089024405504,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:46.140485Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":3.28,\"max_temp\":12.035,\"the_temp\":10.95,\"wind_speed\":6.718962260399269,\"wind_direction\":342,\"air_pressure\":1019,\"humidity\":41,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5944320920125440,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:49.300282Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":3.18,\"max_temp\":12.685,\"the_temp\":10.96,\"wind_speed\":4.103125347967868,\"wind_direction\":9.499999999999998,\"air_pressure\":1023,\"humidity\":32,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":6274590349197312,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:52.213438Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":3.185,\"max_temp\":15.915,\"the_temp\":14.07,\"wind_speed\":1.5716090034200272,\"wind_direction\":351.5,\"air_pressure\":1025,\"humidity\":37,\"visibility\":9.999726596675416,\"predictability\":70},{\"id\":5868348292202496,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:55.911835Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":5.12,\"max_temp\":18.009999999999998,\"the_temp\":16.5,\"wind_speed\":1.6823872584108805,\"wind_direction\":340,\"air_pressure\":1022,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":68}],\"time\":\"2020-02-01T08:53:38.902747-08:00\",\"sun_rise\":\"2020-02-01T07:11:51.633046-08:00\",\"sun_set\":\"2020-02-01T17:31:11.633241-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"Mountain View\",\"location_type\":\"City\",\"woeid\":2455920,\"latt_long\":\"37.39999,-122.079552\",\"timezone\":\"America/Los_Angeles\"}"},
                //missing max_temp
                new object[] {"{\"consolidated_weather\":[{\"id\":6364089280364544,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:40.134222Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":7.04,\"the_temp\":17.63,\"wind_speed\":2.1164638511095206,\"wind_direction\":326,\"air_pressure\":1024,\"humidity\":65,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5525947728003072,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T16:42:43.422590Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":5.5,\"max_temp\":12.695,\"the_temp\":12.15,\"wind_speed\":8.71490415970731,\"wind_direction\":304.5,\"air_pressure\":1018,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":71},{\"id\":4822089024405504,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:46.140485Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":3.28,\"max_temp\":12.035,\"the_temp\":10.95,\"wind_speed\":6.718962260399269,\"wind_direction\":342,\"air_pressure\":1019,\"humidity\":41,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":5944320920125440,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:49.300282Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":3.18,\"max_temp\":12.685,\"the_temp\":10.96,\"wind_speed\":4.103125347967868,\"wind_direction\":9.499999999999998,\"air_pressure\":1023,\"humidity\":32,\"visibility\":9.999726596675416,\"predictability\":68},{\"id\":6274590349197312,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T16:42:52.213438Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":3.185,\"max_temp\":15.915,\"the_temp\":14.07,\"wind_speed\":1.5716090034200272,\"wind_direction\":351.5,\"air_pressure\":1025,\"humidity\":37,\"visibility\":9.999726596675416,\"predictability\":70},{\"id\":5868348292202496,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T16:42:55.911835Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":5.12,\"max_temp\":18.009999999999998,\"the_temp\":16.5,\"wind_speed\":1.6823872584108805,\"wind_direction\":340,\"air_pressure\":1022,\"humidity\":52,\"visibility\":9.999726596675416,\"predictability\":68}],\"time\":\"2020-02-01T08:53:38.902747-08:00\",\"sun_rise\":\"2020-02-01T07:11:51.633046-08:00\",\"sun_set\":\"2020-02-01T17:31:11.633241-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"Mountain View\",\"location_type\":\"City\",\"woeid\":2455920,\"latt_long\":\"37.39999,-122.079552\",\"timezone\":\"America/Los_Angeles\"}"},
            };

        public static IEnumerable<object[]> TestGetLocationSearchCorrect => new[]
            {
                new object[] {"[{\"distance\":3372691,\"title\":\"Honolulu\",\"location_type\":\"City\",\"woeid\":2423945,\"latt_long\":\"21.304850,-157.857758\"},{\"distance\":4133940,\"title\":\"Auckland\",\"location_type\":\"City\",\"woeid\":2348079,\"latt_long\":\"-36.884109,174.770416\"},{\"distance\":4144070,\"title\":\"Manukau\",\"location_type\":\"City\",\"woeid\":2349386,\"latt_long\":\"-36.98967,174.881454\"},{\"distance\":4194696,\"title\":\"Brisbane\",\"location_type\":\"City\",\"woeid\":1100661,\"latt_long\":\"-27.468880,153.022827\"},{\"distance\":4617567,\"title\":\"Wellington\",\"location_type\":\"City\",\"woeid\":2351310,\"latt_long\":\"-41.283779,174.787979\"},{\"distance\":4812830,\"title\":\"Sydney\",\"location_type\":\"City\",\"woeid\":1105779,\"latt_long\":\"-33.869629, 151.206955\"},{\"distance\":4892046,\"title\":\"Christchurch\",\"location_type\":\"City\",\"woeid\":2348327,\"latt_long\":\"-43.527519,172.635422\"},{\"distance\":5522469,\"title\":\"Melbourne\",\"location_type\":\"City\",\"woeid\":1103816,\"latt_long\":\"-37.817532,144.967148\"},{\"distance\":5740940,\"title\":\"Yokohama\",\"location_type\":\"City\",\"woeid\":1118550,\"latt_long\":\"35.452702,139.595123\"},{\"distance\":5741455,\"title\":\"Kawasaki\",\"location_type\":\"City\",\"woeid\":1117502,\"latt_long\":\"35.556332,139.675201\"}]"},
            };
        public static IEnumerable<object[]> TestGetLocationCorrect => new[]
            {
                new object[] {"{\"consolidated_weather\":[{\"id\":5421296982687744,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T15:28:52.246425Z\",\"applicable_date\":\"2020-02-01\",\"min_temp\":7.605,\"max_temp\":18.915,\"the_temp\":17.979999999999997,\"wind_speed\":2.3199637007396805,\"wind_direction\":309.2090295859457,\"air_pressure\":1024.5,\"humidity\":67,\"visibility\":14.527658474508868,\"predictability\":68},{\"id\":6589470885281792,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NW\",\"created\":\"2020-02-01T15:28:55.323094Z\",\"applicable_date\":\"2020-02-02\",\"min_temp\":5.78,\"max_temp\":12.3,\"the_temp\":12.265,\"wind_speed\":11.20130820647154,\"wind_direction\":308.0028554874213,\"air_pressure\":1018.5,\"humidity\":51,\"visibility\":16.17739898989899,\"predictability\":70},{\"id\":6547196889530368,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T15:28:58.601143Z\",\"applicable_date\":\"2020-02-03\",\"min_temp\":3.455,\"max_temp\":11.280000000000001,\"the_temp\":11.379999999999999,\"wind_speed\":8.017165173599512,\"wind_direction\":339.83337612796305,\"air_pressure\":1019,\"humidity\":38,\"visibility\":18.415888709933984,\"predictability\":68},{\"id\":6484074803757056,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"N\",\"created\":\"2020-02-01T15:29:01.222194Z\",\"applicable_date\":\"2020-02-04\",\"min_temp\":2.08,\"max_temp\":11.940000000000001,\"the_temp\":11.36,\"wind_speed\":5.104286098645245,\"wind_direction\":356.5643895906268,\"air_pressure\":1022,\"humidity\":32,\"visibility\":18.765410005567485,\"predictability\":68},{\"id\":5212155295039488,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T15:29:04.397657Z\",\"applicable_date\":\"2020-02-05\",\"min_temp\":3.315,\"max_temp\":15.26,\"the_temp\":13.705,\"wind_speed\":2.076727135613351,\"wind_direction\":326.65138448665454,\"air_pressure\":1024,\"humidity\":37,\"visibility\":17.710943092340727,\"predictability\":70},{\"id\":5768939797741568,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2020-02-01T15:29:07.498660Z\",\"applicable_date\":\"2020-02-06\",\"min_temp\":5.654999999999999,\"max_temp\":17.585,\"the_temp\":16.5,\"wind_speed\":1.5973872584108804,\"wind_direction\":341.5,\"air_pressure\":1022,\"humidity\":49,\"visibility\":9.999726596675416,\"predictability\":68}],\"time\":\"2020-02-01T08:54:32.620654-08:00\",\"sun_rise\":\"2020-02-01T07:10:57.961227-08:00\",\"sun_set\":\"2020-02-01T17:30:32.270270-08:00\",\"timezone_name\":\"LMT\",\"parent\":{\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"},\"sources\":[{\"title\":\"BBC\",\"slug\":\"bbc\",\"url\":\"http://www.bbc.co.uk/weather/\",\"crawl_rate\":360},{\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480},{\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180},{\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360},{\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720},{\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}],\"title\":\"San Jose\",\"location_type\":\"City\",\"woeid\":2488042,\"latt_long\":\"37.338581,-121.885567\",\"timezone\":\"America/Los_Angeles\"}"},
            };
        #endregion

        [Theory]
        [MemberData(nameof(TestCorrectLocation))]
        public void DeserializeCorrectLocationSearches(string data)
        {
            _ = JsonConvert.DeserializeObject<WeatherLocation>(data);
        }

        [Theory]
        [MemberData(nameof(TestIncorrectLocation))]
        public void DeserializeIncorrectLocations(string data)
        {
            ((Action)(() => _ = JsonConvert.DeserializeObject<WeatherLocation>(data)))
                .Should().Throw<JsonSerializationException>();
        }

        [Theory]
        [MemberData(nameof(TestCorrectLocationDetail))]
        public void DeserializeCorrectLocationDetail(string data)
        {
            _ = JsonConvert.DeserializeObject<WeatherLocationDetail>(data);
        }

        [Theory]
        [MemberData(nameof(TestIncorrectLocationDetail))]
        public void DeserializeIncorrectLocation(string data)
        {
            ((Action)(() => _ = JsonConvert.DeserializeObject<WeatherLocationDetail>(data)))
                .Should().Throw<JsonSerializationException>();
        }

        [Theory]
        [MemberData(nameof(TestGetLocationSearchCorrect))]
        public async void GetWeatherLocationSearches(string data)
        {
            var handler = HandlerMockFactory.GetHandlerMock(data);
            var weatherService = new WeatherServiceClient(handler);
            var result = await weatherService.GetWeatherLocations(0d, 0d);

            result.Should().NotBeNull();
        }

        [Theory]
        [MemberData(nameof(TestGetLocationCorrect))]
        public async void GetWeatherLocation(string data)
        {
            var handler = HandlerMockFactory.GetHandlerMock(data);
            var weatherService = new WeatherServiceClient(handler);
            var result = await weatherService.GetWeatherLocationDetail("0");

            result.Should().NotBeNull();
        }
    }
}
